<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Follow-up Sender</title>
<style>
  body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:16px;max-width:860px}
  h1{margin:0 0 12px}
  .card{border:1px solid #ddd;border-radius:12px;padding:14px;margin:12px 0}
  label{display:block;font-weight:600;margin:10px 0 6px}
  input,textarea{width:100%;box-sizing:border-box;padding:12px;border:1px solid #ccc;border-radius:10px}
  .row{display:flex;gap:12px} .row>div{flex:1}
  .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
  button{border:1px solid #ccc;border-radius:999px;padding:10px 14px;cursor:pointer;background:#fff}
  .pill{font-size:12px;background:#f4f4f4;border-radius:999px;padding:4px 8px;margin-left:6px}
  #pos{opacity:.7;margin-top:8px}
  .tiny{font-size:12px;opacity:.8}
</style>
</head>
<body>
<h1>Follow-up Sender <span class="pill">v1.1</span></h1>

<div class="card">
  <label>Paste customer blocks (blank line between each):</label>
  <textarea id="blocks" rows="10" placeholder="Example:
50423995 - Alex Taylor - SO14 1AA - (C3_01_155)
£150.00
22HSO14
18/11/2025
07123456789
07123456789
alex.taylor@example.com
https://example.com/lead/12345"></textarea>
  <div class="btns">
    <button onclick="parseAll()">Parse</button>
    <button onclick="example()">Load Example</button>
  </div>
  <div class="tiny">
    Expected lines per customer:  
    1) LeadID - Name - Postcode - (Product)<br>
    2) Amount • 3) Offer Code • 4) Date • 5–6) Phones • 7) Email • 8) Link
  </div>
</div>

<div id="work" class="card" style="display:none">
  <div class="row">
    <div><label>Lead ID</label><input id="lead"></div>
    <div><label>Name</label><input id="name"></div>
  </div>
  <div class="row">
    <div><label>Postcode</label><input id="pc"></div>
    <div><label>Product Code</label><input id="prod"></div>
  </div>
  <div class="row">
    <div><label>Offer Code</label><input id="offer"></div>
    <div><label>Amount</label><input id="amount"></div>
  </div>
  <div class="row">
    <div><label>Date</label><input id="date" inputmode="numeric"></div>
    <div><label>Email</label><input id="email" type="email"></div>
  </div>
  <div class="row">
    <div><label>Phone 1</label><input id="phone1" inputmode="tel"></div>
    <div><label>Phone 2</label><input id="phone2" inputmode="tel"></div>
  </div>
  <label>Quote Link</label><input id="link">

  <label>SMS Template</label>
  <textarea id="sms" rows="5">Good morning, it’s Martin Bibb from British Gas. I recently came and visited you and provided you with a new boiler quotation.

I’m just following up some of my quotations and I’ve noticed that the office has offered you an extra £150 discount due to having spare engineer installation capacity at the moment.

I just wanted to check you’ve seen the email with this discount attached. If you’re interested in accepting the extra £150 off and haven’t seen the email, please let me know and I’ll guide you through the next stages.

Have a great day!</textarea>

  <label>Email Subject</label>
  <input id="subj" value="Your British Gas boiler quote & £150 discount">

  <label>Email Body</label>
  <textarea id="body" rows="7">Hello {{name}},

I hope you’re well. I recently visited you to provide a quotation for a new boiler. I wanted to let you know that British Gas are currently offering an additional £150 discount on your quote due to spare installation capacity.

Please check your email for the updated quote including this discount. If you haven’t received it or would like to go ahead, just let me know and I can guide you through the next steps.

Best regards,
Martin Bibb
British Gas</textarea>

  <div class="btns">
    <button onclick="sendSMS()">Send SMS</button>
    <button onclick="sendEmail()">Send Email</button>
    <button onclick="copyAll()">Copy both</button>
    <button onclick="prev()">◀︎ Prev</button>
    <button onclick="next()">Next ▶︎</button>
  </div>
  <div id="pos"></div>
</div>

<script>
let items=[], i=0;
function example(){
  document.getElementById('blocks').value =
`50423995 - Alex Taylor - SO14 1AA - (C3_01_155)
£150.00
22HSO14
18/11/2025
07123456789
07123456789
alex.taylor@example.com
https://example.com/lead/12345`;
}

function parseAll(){
  const raw=document.getElementById('blocks').value.replace(/\r/g,'').trim();
  if(!raw){alert('Paste at least one customer block.');return;}
  const blocks=raw.split(/\n\s*\n/);
  items=blocks.map(parseBlock).filter(Boolean);
  if(!items.length){alert('Could not parse any valid blocks.');return;}
  i=0;document.getElementById('work').style.display='block';load();
}
function parseBlock(text){
  const lines=text.split(/\n/).map(s=>s.trim()).filter(Boolean);
  if(lines.length<8)return null;
  const m=lines[0].match(/^\s*([^-\n]+)\s*-\s*([^-\n]+)\s*-\s*([A-Z0-9 ]+)\s*-\s*\(([^)]+)\)\s*$/i);
  if(!m)return null;
  const [_,lead,name,pc,prod]=m;
  return{lead:lead.trim(),name:name.trim(),pc:pc.trim(),prod:prod.trim(),
         amount:lines[1]||'',offer:lines[2]||'',date:lines[3]||'',
         phone1:lines[4]||'',phone2:lines[5]||'',email:lines[6]||'',link:lines[7]||''};
}
function load(){
  const d=items[i];
  for(const k of ['lead','name','pc','prod','amount','offer','date','phone1','phone2','email','link'])
    document.getElementById(k).value=d[k]||'';
  document.getElementById('pos').textContent=`Customer ${i+1} of ${items.length}`;
}
function getData(){
  const g=id=>document.getElementById(id).value.trim();
  return{lead:g('lead'),name:g('name'),pc:g('pc'),prod:g('prod'),
    amount:g('amount'),offer:g('offer'),date:g('date'),
    phone:g('phone1')||g('phone2'),email:g('email'),link:g('link'),
    smsTpl:document.getElementById('sms').value,
    subjTpl:document.getElementById('subj').value,
    bodyTpl:document.getElementById('body').value};
}
function fill(t,d){
  return t.replaceAll('{{lead}}',d.lead).replaceAll('{{name}}',d.name)
  .replaceAll('{{pc}}',d.pc).replaceAll('{{prod}}',d.prod)
  .replaceAll('{{amount}}',d.amount).replaceAll('{{offer}}',d.offer)
  .replaceAll('{{date}}',d.date).replaceAll('{{link}}',d.link);
}
function sendSMS(){
  const d=getData();
  const body=fill(d.smsTpl,d);
  const num=(d.phone||'').replace(/\s+/g,'');
  const base=num?`sms:${encodeURIComponent(num)}`:'sms:';
  const url=`${base}&body=${encodeURIComponent(body)}`; // No + replacements
  location.href=url;
}
function sendEmail(){
  const d=getData();
  const to=d.email?encodeURIComponent(d.email):'';
  const subj=encodeURIComponent(fill(d.subjTpl,d));
  const body=encodeURIComponent(fill(d.bodyTpl,d));
  location.href=`mailto:${to}?subject=${subj}&body=${body}`;
}
async function copyAll(){
  const d=getData();
  const sms='SMS:\n'+fill(d.smsTpl,d)+'\n\n';
  const email='EMAIL SUBJECT:\n'+fill(d.subjTpl,d)+'\n\nEMAIL BODY:\n'+fill(d.bodyTpl,d);
  try{await navigator.clipboard.writeText(sms+email);alert('Copied to clipboard.');}
  catch{alert('Copy failed.');}
}
function next(){if(i<items.length-1){i++;load();}}
function prev(){if(i>0){i--;load();}}
</script>
</body>
</html>